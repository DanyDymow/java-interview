## Оркестрация SAGA

![Alt текст](/img/micro-patterns/saga.png)

У нас есть сервис А, который выступает как оркестратор, он вызывает сервис Б и восстанавливается от падений с помощью компенсаторной операции при необходимости.

Ключевым моментом является то, что оба сервиса работают в своих локальных транзакциях
В данном случае запрос от сервиса А к сервису Б будет выполнен в рамках транзакции.

Оркестрация является подходом с консистентностью в конечном счете, которая может включать в себя реатраи и роллбеки, для поддержки консистентного состояния.

Сервисы участники данного паттерна должны предоставлять идемпотентные операции, поскольку возможно выполнение ретраев, также они должны предоставлять эндпоинты для отката транзакций, чтобы сохранять согласованность данных.

Сильной стороной данного подхода является возможность разных сервисов, не поддерживающих распределенных транзакций, оставаться в консистентном состоянии используя только локальные транзакции.

При этом всегда можно узнать текущее состояние системы у координатора.

Плюсы Оркестрации:
- управление состоянием между разными сервисами в распределенной системе
- нет необходимости в XA транзакциях
- всегда можно узнать в каком состоянии находится система

Минусы Оркестрации:
- сложная распределенная модель разработки
- требует наличия идемпотентности и компенсаторных транзакций
- согласованность в конечном счете
- возможны невосстанавливаемые падения (unrecoverable failures) при выполнении компенсаторных транзакций